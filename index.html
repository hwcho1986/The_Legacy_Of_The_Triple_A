<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Legacy Of The Triple A - 대괴도 AAA의 유산 v0.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=Cinzel:wght@400;700&family=Nanum+Myeongjo:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary-red: #b91c1c;
            --overlay-dark: rgba(0, 0, 0, 0.85);
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Noto Serif KR', 'Nanum Myeongjo', serif;
            color: #fff;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .font-cinzel {
            font-family: 'Cinzel', serif;
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 1.5s ease-out forwards;
        }

        .fade-out {
            animation: fadeOut 1.2s ease-in forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        /* UI Elements */
        .menu-btn {
            position: relative;
            padding: 1rem 2.5rem;
            font-size: 1.25rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: left;
            border-left: 0px solid var(--primary-red);
            overflow: hidden;
        }

        .menu-btn.active {
            background: linear-gradient(90deg, rgba(185, 28, 28, 0.2) 0%, transparent 100%);
            border-left-width: 6px;
            padding-left: 3.5rem;
            color: #fff;
            text-shadow: 0 0 10px rgba(185, 28, 28, 0.5);
        }

        .menu-btn::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0%;
            height: 1px;
            background-color: rgba(255, 255, 255, 0.2);
            transition: width 0.3s ease;
        }

        .menu-btn:hover::before {
            width: 100%;
        }

        .textbox-gradient {
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.8));
            box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.5);
        }

        .typewriter-cursor::after {
            content: '▼';
            margin-left: 8px;
            color: var(--primary-red);
            animation: blink 0.8s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        /* Custom Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: #333;
            border-radius: 2px;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: var(--primary-red);
            margin-top: -6px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(185, 28, 28, 0.5);
        }

        /* Cinematic Effects */
        .bg-transition {
            transition: background-image 1.5s ease-in-out;
        }

        .crt-effect {
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        .terminal-text {
            color: #0f0;
            text-shadow: 0 0 5px #0f0;
            font-family: 'Courier New', Courier, monospace;
        }

        @keyframes scanline {
            0% {
                transform: translateY(-100%);
            }

            100% {
                transform: translateY(100%);
            }
        }

        .scanline {
            width: 100%;
            height: 100px;
            z-index: 100;
            background: linear-gradient(0deg, rgba(0, 0, 0, 0) 0%, rgba(255, 255, 255, 0.2) 50%, rgba(0, 0, 0, 0) 100%);
            opacity: 0.1;
            position: absolute;
            bottom: 100%;
            animation: scanline 8s linear infinite;
        }

        .animate-shake {
            animation: shake 0.5s cubic-bezier(.36, .07, .19, .97) both;
        }

        @keyframes shake {

            10%,
            90% {
                transform: translate3d(-1px, 0, 0);
            }

            20%,
            80% {
                transform: translate3d(2px, 0, 0);
            }

            30%,
            50%,
            70% {
                transform: translate3d(-4px, 0, 0);
            }

            40%,
            60% {
                transform: translate3d(4px, 0, 0);
            }
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
    </style>
    <style>
        /* [Existing Styles Kept for Brevity in this thought, but will be in the actual replacement] */
    </style>
</head>

<body>
    <div id="game-container" class="w-full h-screen relative overflow-hidden bg-black">
        <!-- Screens will be injected here -->
    </div>

    <script>
        /**
         * THE LEGACY OF THE TRIPLE A (대괴도 AAA의 유산)
         * Static Standalone Engine
         */

        const LOCALIZATION = {
            "AAA": { "KO": "AAA", "EN": "AAA", "JP": "AAA" },
            "알루카드": { "KO": "알루카드", "EN": "Alucard", "JP": "アルカード" },
            "정성훈": { "KO": "정성훈", "EN": "Jung Sung-hoon", "JP": "チョン・ソンフン" },
            "시스템": { "KO": "시스템", "EN": "SYSTEM", "JP": "시스템" },
            "비문": { "KO": "비문", "EN": "Inscription", "JP": "碑文" },
            "문지기": { "KO": "문지기", "EN": "Gatekeeper", "JP": "門番" },
            "DISCLAIMER": {
                "KO": "해당 게임은 단편의 짧은 게임이기에 세이브를 지원하지 않습니다. 게임 플레이 시, 창을 닫으면 처음부터 시작해야합니다. 또한 이 작품에서 등장한 모든 이름, 인물, 사건들은 허구입니다. 실존하는 인물, 장소, 건물, 제품과는 일절 관련이 없습니다.",
                "EN": "This game is a short story and does not support saving. Closing the window will reset progress. All entities in this work are fictional and not related to real persons or places.",
                "JP": "このゲームは短編のためセーブ機能はありません。ブラウザを閉じると最初부터になります。また、本作에 등장한 이름, 이름, 인물, 사건들은 모두 피션입니다.",
                "CN_S": "本游戏为短篇故事，不支持存档. 关闭窗口将重置进度. 所有名称、人物和事件均为虚构.",
                "CN_T": "本遊戲為短篇故事，不支援存檔. 關閉窗口將重置進度. 所有名稱、人物和事件均為虛構.",
                "ES": "Este juego es una historia corta y no admite guardado. Todos los nombres son ficticios."
            },
            "START_GAME": { "KO": "게임 시작", "EN": "START GAME", "JP": "ゲーム開始", "CN_S": "开始游戏", "CN_T": "開始遊戲", "ES": "INICIAR" },
            "OPTIONS": { "KO": "옵션", "EN": "OPTIONS", "JP": "OPTIONS", "CN_S": "选项", "CN_T": "選項", "ES": "OPCIONES" },
            "SCORE": { "KO": "스코어", "EN": "SCORE", "JP": "スコア", "CN_S": "得分", "CN_T": "得分", "ES": "PUNTOS" },
            "CREDITS": { "KO": "제작진", "EN": "CREDITS", "JP": "クレジット", "CN_S": "制作人员", "CN_T": "製作人員", "ES": "CRÉDITOS" },
            "EXIT": { "KO": "종료", "EN": "EXIT", "JP": "終了", "CN_S": "退出", "CN_T": "退出", "ES": "SALIR" },
            "QUIT_CONFIRM": { "KO": "현재 창을 닫고 게임을 종료하시겠습니까?", "EN": "Quit and close window?", "JP": "ゲームを終了しますか？", "CN_S": "确定退出吗？", "CN_T": "確定退出嗎？", "ES": "¿Cerrar el juego?" },
            "YES": { "KO": "예", "EN": "YES", "JP": "はい", "CN_S": "은", "CN_T": "是", "ES": "SÍ" },
            "NO": { "KO": "아니오", "EN": "NO", "JP": "いいえ", "CN_S": "否", "CN_T": "否", "ES": "NO" },
            "PROLOGUE_001": { "KO": "안녕하십니까. 이 편지를 받는 모든 분들께 깊은 감사를 느끼고 있습니다.", "EN": "Greetings. I feel deep gratitude to all who receive this letter.", "JP": "皆様、この手紙を手に取っていただき、深く感謝しております。" },
            "PROLOGUE_002": { "KO": "제 이름은 AAA. 저를 잘 아시는 분들은 멋쟁이 A나 트리플 에이라고들 불러주시죠.", "EN": "My name is AAA. To those who know me, I am Dashing A or Triple A.", "JP": "私の名前はAAA。私をよく知る人々は、おしゃれなAやトリプルAと呼んでくれます。" },
            "PROLOGUE_003": { "KO": "저는 소싯적에 대도였습니다. 세계 각지를 돌아다니면서 유명한 부호들의 저택을 털었죠.", "EN": "I was a master thief in my youth. I traveled the world and robbed the mansions of billionaires.", "JP": "私は若い頃、大泥棒でした。世界各地を巡り、有名な富豪たちの屋敷を襲いました。" },
            "PROLOGUE_004": { "KO": "제가 훔쳐온 명화들은 전부 모조품으로 바꿔치기 했습니다. 진짜와 구별할 수 없는 완벽한 모조품으로요.", "EN": "All the paintings I stole were replaced with replicas. Perfect copies, indistinguishable from the originals.", "JP": "私が盗んできた名画の数々は、すべて模造品にすり替えました。本物と見分けがつかない完璧な模造品에입니다." },
            "PROLOGUE_005": { "KO": "하지만 사람은 늙고 결국 죽게 됩니다. 재산을 후계자에게 남길 생각은 없습니다.", "EN": "But man grows old and eventually dies. I have no intention of leaving my fortune to an heir.", "JP": "しかし、人は老いて最後には死にます。財産を後継者に残すつもりはありません。" },
            "PROLOGUE_006": { "KO": "저의 모든 재화는 '그곳'에서 새로운 주인만을 기다리고 있을 것입니다.", "EN": "All my wealth is waiting for a new master in 'that place'.", "JP": "私のすべての財産は「あの場所」で新しい主人を待っています。" },
            "PROLOGUE_007": { "KO": "도전하시겠습니까? 하지만 그곳은 쉽게 갈 수 있는 곳이 아닙니다. 수많은 함정과 미로를 헤쳐나가야 하죠.", "EN": "Will you accept the challenge? But it is not a place easily reached. You must navigate countless traps and labyrinths.", "JP": "挑戦しますか？ しかし、そこは簡単に行ける場所ではありません。数多くの罠と迷宮を切り抜けなければなりません。" },
            "PROLOGUE_008": { "KO": "생명의 위협이 두렵다면 즉시 이 편지를 버리시는 게 좋을 겁니다. 하하하하!", "EN": "If you fear for your life, you should discard this letter immediately. Hahahaha!", "JP": "命の危険が怖いのであれば、すぐにこの手紙を捨てたほうがいいでしょう。ハハハハ！" },
            "PROLOGUE_009": { "KO": "파티가 시작되는 장소는 Alucard 집사의 집에서 시작합니다. 우선 그가 있는 나라로 가는 것이 좋을 겁니다.", "EN": "The party begins at the home of my butler, Alucard. First, you should travel to the country where he resides.", "JP": "パーティーが始まる場所は、執事アルカードの家から始まります。まず、彼がいる国へ行くのがよいでしょう。" },
            "S1_1_001": { "KO": "루마니아... 이곳인가.", "EN": "Romania... is this the place?", "JP": "ルーマニア… ここか。" },
            "S1_1_002": { "KO": "이메일이 도착했습니다.", "EN": "A new email has arrived.", "JP": "メールが届きました。" },
            "S1_1_003": { "KO": "이미 당신이 올 것을 알고 있었습니다. 트랜실바니아(Transylvania)로 오십시오.", "EN": "I already knew you were coming. Come to Transylvania.", "JP": "あなたが来ることはすでに分かっていました。トランシルバニアへお越しください。" },
            "S1_2_001": { "KO": "비밀의 방 안에서 검은 창을 발견했다.", "EN": "A black spear was found inside a secret room.", "JP": "秘密の部屋の中で黒い槍を見つけた。" },
            "S1_2_002": { "KO": "나는 번개이며, 관통하는 자이다. 결코 빗나가지 않으며 꺾이지 않는다. 나는 아스가르드의 신의 창이다.", "EN": "I am thunder, I am the piercer. I never miss and cannot be broken. I am the spear of the god of Asgard.", "JP": "私は雷であり、貫く者である。決して外れず、折れることもない。私はアスガルドの神の槍である。" },
            "S1_3_001": { "KO": "창을 구멍에 꽂았다. 육중한 소리와 함께 문이 열린다.", "EN": "I inserted the spear into the hole. The door opens with a heavy sound.", "JP": "槍を穴に差し込んだ。重々しい音とともに門が開く。" },
            "S1_3_002": { "KO": "함정과 미궁이 기다리고 있다. 준비되었는가?", "EN": "Traps and labyrinths await. Are you prepared?", "JP": "罠と迷宮が待ち受けている。準備はいいか？" },
            "S1_3_003": { "KO": "포기하지 않겠다.", "EN": "I will not give up.", "JP": "諦めない。" },
            "S1_4_001": { "KO": "벽이 좁혀져 온다! 케르베로스의 첫 번째 답을 입력해야 한다.", "EN": "The walls are closing in! Enter the first answer to Kerberos.", "JP": "壁が迫ってくる！ ケルベロスの最初の答えを入力しなければならない。" },
            "S1_5_001": { "KO": "두 번째 머리의 답은 펜의 획수를 알파벳으로 치환한 것이다.", "EN": "The answer for the second head is the stroke count of the pen converted to an alphabet.", "JP": "二番目の頭の答えは、ペンの画数をアルファベットに置換したものだ。" },
            "S1_6_001": { "KO": "세 번째 머리를 지배(Dominate)하라.", "EN": "Dominate the third head.", "JP": "三番目の頭を支配（Dominate）せよ。" },
            "S1_7_001": { "KO": "바닥에 26개의 구멍이 뚫려 있고 조잡한 창이 꽂혀 있다.", "EN": "There are 26 holes in the floor, and a crude spear is stuck there.", "JP": "床に26個の穴が開いており、粗末な槍が刺さっている。" },
            "S1_7_002": { "KO": "나는 신을 찌른 창이다.", "EN": "I am the spear that pierced God.", "JP": "私は神を突いた槍である。" },
            "S1_7_003": { "KO": "1번 구멍에 창을 3번 꽂았다. 벽이 열리며 푸른 비단에 덮인 그림이 나타난다.", "EN": "I inserted the spear into hole #1 three times. The wall opens, revealing a painting covered in blue silk.", "JP": "1番の穴に槍を3回差し込んだ. 壁が開き、青い絹에 덮인 그림이 나타난다." }
        };

        const CHAPTER_DATA = [
            { "id": 1001, "type": "BG_CHANGE", "value": "assets/images/bg_mansion_hall.png" },
            { "id": 1002, "type": "BGM_PLAY", "value": "https://incompetech.com/music/royalty-free/mp3-royaltyfree/Comfortable%20Mystery.mp3" },
            { "id": 1003, "type": "CHAR_ENTER", "target": "AAA", "value": "center" },
            { "id": 1004, "type": "DIALOGUE", "target": "AAA", "value": "PROLOGUE_001" },
            { "id": 1005, "type": "DIALOGUE", "target": "AAA", "value": "PROLOGUE_002" },
            { "id": 1006, "type": "DIALOGUE", "target": "AAA", "value": "PROLOGUE_003" },
            { "id": 1007, "type": "DIALOGUE", "target": "AAA", "value": "PROLOGUE_004" },
            { "id": 1008, "type": "DIALOGUE", "target": "AAA", "value": "PROLOGUE_005" },
            { "id": 1009, "type": "DIALOGUE", "target": "AAA", "value": "PROLOGUE_006" },
            { "id": 1010, "type": "DIALOGUE", "target": "AAA", "value": "PROLOGUE_007" },
            { "id": 1011, "type": "DIALOGUE", "target": "AAA", "value": "PROLOGUE_008" },
            { "id": 1012, "type": "DIALOGUE", "target": "AAA", "value": "PROLOGUE_009" },
            { "id": 1013, "type": "QUIZ", "target": "quiz_1", "value": "romania", "options": { "hint": "1. Turn, 2. 나라 이름 (소문자로)", "question": "그가 있는 나라는 어디인가?" } },
            { "id": 1014, "type": "BG_CHANGE", "value": "assets/images/bg_transylvania.png" },
            { "id": 1015, "type": "CHAR_EXIT", "target": "AAA" },
            { "id": 1016, "type": "DIALOGUE", "target": "정성훈", "value": "S1_1_001" },
            { "id": 1017, "type": "SFX_PLAY", "value": "https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3" },
            { "id": 1018, "type": "DIALOGUE", "target": "시스템", "value": "S1_1_002" },
            { "id": 1019, "type": "DIALOGUE", "target": "알루카드", "value": "S1_1_003" },
            { "id": 1020, "type": "QUIZ", "target": "quiz_2", "value": "brancastle", "options": { "hint": "집사의 집 이름 (소문자로, 공백 없이)", "question": "어디로 가야 하는가?" } },
            { "id": 1021, "type": "BG_CHANGE", "value": "https://images.unsplash.com/photo-1533154683836-84ea7a0bc310?q=80&w=1920" },
            { "id": 1022, "type": "DIALOGUE", "target": "정성훈", "value": "S1_2_001" },
            { "id": 1023, "type": "DIALOGUE", "target": "비문", "value": "S1_2_002" },
            { "id": 1024, "type": "QUIZ", "target": "quiz_3", "value": "gungnir", "options": { "hint": "아스가르드의 신의 창", "question": "창의 이름을 입력하세요." } },
            { "id": 1025, "type": "SFX_PLAY", "value": "https://assets.mixkit.co/active_storage/sfx/2180/2180-preview.mp3" },
            { "id": 1026, "type": "DIALOGUE", "target": "정성훈", "value": "S1_3_001" },
            { "id": 1027, "type": "DIALOGUE", "target": "문지기", "value": "S1_3_002" },
            { "id": 1028, "type": "DIALOGUE", "target": "정성훈", "value": "S1_3_003" },
            { "id": 1029, "type": "BG_CHANGE", "value": "https://images.unsplash.com/photo-1599423300746-b62533397364?q=80&w=1920" },
            { "id": 1030, "type": "DIALOGUE", "target": "시스템", "value": "S1_4_001" },
            { "id": 1031, "type": "QUIZ", "target": "quiz_4", "value": "1151825181519", "options": { "hint": "K(11)e(5)r(18)b(2)e(5)r(18)o(15)s(19)", "question": "첫 번째 머리의 답을 입력하세요." } },
            { "id": 1032, "type": "DIALOGUE", "target": "시스템", "value": "S1_5_001" },
            { "id": 1033, "type": "QUIZ", "target": "quiz_5", "value": "j", "options": { "hint": "펜의 획수를 세어보자. (10 -> j)", "question": "두 번째 머리의 답을 입력하세요." } },
            { "id": 1034, "type": "DIALOGUE", "target": "시스템", "value": "S1_6_001" },
            { "id": 1035, "type": "QUIZ", "target": "quiz_6", "value": "heracles", "options": { "hint": "케르베로스를 굴복시킨 영웅", "question": "세 번째 머리의 답을 입력하세요." } },
            { "id": 1036, "type": "DIALOGUE", "target": "정성훈", "value": "S1_7_001" },
            { "id": 1037, "type": "DIALOGUE", "target": "비문", "value": "S1_7_002" },
            { "id": 1038, "type": "QUIZ", "target": "quiz_7", "value": "111", "options": { "hint": "창의 이름을 숫자로 치환하여 합산하라 (LONGINUS)", "question": "창을 꽂을 구멍 번호를 입력하세요." } },
            { "id": 1039, "type": "SFX_PLAY", "value": "https://assets.mixkit.co/active_storage/sfx/2180/2180-preview.mp3" },
            { "id": 1040, "type": "DIALOGUE", "target": "시스템", "value": "S1_7_003" },
            { "id": 1041, "type": "BG_CHANGE", "value": "https://images.unsplash.com/photo-1579783902614-a3fb3927b6a5?q=80&w=1920" },
            { "id": 1042, "type": "DIALOGUE", "target": "정성훈", "value": "이것이... AAA의 유산인가?" },
            { "id": 1043, "type": "GAME_END", "value": "SUCCESS" }
        ];

        const State = {
            screen: 'DISCLAIMER',
            language: 'KO',
            menuIndex: 0,
            currentEventIndex: 0,
            events: CHAPTER_DATA,
            localization: LOCALIZATION,
            startTime: 0,
            isTextAnimating: false,
            history: [],
            scores: JSON.parse(localStorage.getItem('aaa_scores') || '[]'),
            settings: {
                masterVol: 80, bgmVol: 60, sfxVol: 70, voiceVol: 80, mute: false,
                lang: 'KO', textSpeed: 0.8, autoWait: 2000,
                opacity: 0.85, fontSize: 32, font: 'Noto Serif KR', outline: true
            },
            currentView: {
                background: '',
                characters: {}, // { id: position }
                name: '',
                dialogue: '',
                quiz: null
            },
            audio: {
                bgm: null,
                sfx: new Audio()
            }
        };

        const container = document.getElementById('game-container');

        // Audio Controller
        const AudioManager = {
            playBGM: (url) => {
                if (State.audio.bgm) {
                    State.audio.bgm.pause();
                }
                State.audio.bgm = new Audio(url);
                State.audio.bgm.loop = true;
                State.audio.bgm.volume = (State.settings.bgmVol / 100) * (State.settings.masterVol / 100);
                State.audio.bgm.play().catch(() => console.log("User interaction required for audio"));
            },
            playSFX: (url) => {
                const sfx = new Audio(url);
                sfx.volume = (State.settings.sfxVol / 100) * (State.settings.masterVol / 100);
                sfx.play().catch(() => { });
            }
        };

        function initGame() {
            const browserLang = navigator.language.split('-')[0].toUpperCase();
            const supportedLangs = ['KO', 'EN', 'JP', 'CN_S', 'CN_T', 'ES'];
            if (supportedLangs.includes(browserLang)) State.language = browserLang;

            render();
            window.addEventListener('resize', handleResize);
            handleResize();
        }

        // [Rest of the functions remain the same: handleResize, t, navigate, processNextEvent, render, renderDisclaimer, renderMenu, renderMenuButtons, renderGame, showQuizOverlay, handleGameEnd, renderOptions, renderScore, renderCredits, renderExitConfirm]

        // ... (I will keep the rest of the engine here in the actual file)

        function handleResize() {
            const targetWidth = 1920;
            const targetHeight = 1080;
            const scaleX = window.innerWidth / targetWidth;
            const scaleY = window.innerHeight / targetHeight;
            const scale = Math.min(scaleX, scaleY);

            const gameArea = document.getElementById('game-area');
            if (gameArea) {
                gameArea.style.transform = `scale(${scale})`;
                gameArea.style.left = `${(window.innerWidth - targetWidth * scale) / 2}px`;
                gameArea.style.top = `${(window.innerHeight - targetHeight * scale) / 2}px`;
            }
        }

        function t(key) {
            if (!State.localization || !State.localization[key]) return key;
            const entry = State.localization[key];
            return entry[State.language] || entry['EN'] || key;
        }

        function navigate(screen) {
            State.screen = screen;
            if (screen === 'GAME') {
                State.currentEventIndex = 0;
                State.history = [];
                State.startTime = Date.now();
                State.currentView.characters = {};
                processNextEvent();
            }
            render();
        }

        function processNextEvent() {
            if (State.currentEventIndex >= State.events.length) return;

            const event = State.events[State.currentEventIndex];
            State.currentEventIndex++;

            switch (event.type) {
                case 'DIALOGUE':
                    State.currentView.name = event.target || '';
                    State.currentView.dialogue = t(event.value);
                    State.currentView.quiz = null;
                    render();
                    break;
                case 'BG_CHANGE':
                    State.currentView.background = event.value;
                    render();
                    processNextEvent();
                    break;
                case 'CHAR_ENTER':
                    State.currentView.characters[event.target] = event.value || 'center';
                    render();
                    processNextEvent();
                    break;
                case 'CHAR_EXIT':
                    delete State.currentView.characters[event.target];
                    render();
                    processNextEvent();
                    break;
                case 'BGM_PLAY':
                    AudioManager.playBGM(event.value);
                    processNextEvent();
                    break;
                case 'SFX_PLAY':
                    AudioManager.playSFX(event.value);
                    processNextEvent();
                    break;
                case 'WAIT':
                    setTimeout(processNextEvent, (event.value || 1) * 1000);
                    break;
                case 'QUIZ':
                    State.currentView.quiz = event;
                    render();
                    break;
                case 'GAME_END':
                    handleGameEnd(event.value);
                    break;
            }
        }

        function render() {
            container.innerHTML = '';
            const area = document.createElement('div');
            area.id = 'game-area';
            area.className = 'absolute w-[1920px] h-[1080px] origin-top-left overflow-hidden bg-black shadow-2xl';
            container.appendChild(area);

            switch (State.screen) {
                case 'DISCLAIMER': renderDisclaimer(area); break;
                case 'MENU': renderMenu(area); break;
                case 'GAME': renderGame(area); break;
                case 'OPTIONS': renderOptions(area); break;
                case 'SCORE': renderScore(area); break;
                case 'CREDITS': renderCredits(area); break;
                case 'EXIT_CONFIRM': renderExitConfirm(area); break;
            }
            handleResize();
        }

        function renderDisclaimer(parent) {
            const el = document.createElement('div');
            el.className = 'flex items-center justify-center h-full p-40 fade-in text-center';
            el.innerHTML = `<p class="text-5xl text-neutral-400 italic font-serif leading-loose">${t('DISCLAIMER')}</p>`;
            parent.appendChild(el);
            setTimeout(() => {
                el.classList.replace('fade-in', 'fade-out');
                setTimeout(() => navigate('MENU'), 1200);
            }, 5000);
        }

        function renderMenu(parent) {
            const menuItems = [
                { id: 'GAME', key: 'START_GAME' },
                { id: 'OPTIONS', key: 'OPTIONS' },
                { id: 'SCORE', key: 'SCORE' },
                { id: 'CREDITS', key: 'CREDITS' },
                { id: 'EXIT_CONFIRM', key: 'EXIT' }
            ];

            parent.innerHTML = `
                <div class="absolute inset-0 opacity-30 bg-cover bg-center bg-[url('https://images.unsplash.com/photo-1582555172866-f73bb12a2ab3?q=80&w=1920')]"></div>
                <div class="relative z-10 h-full flex flex-col items-center justify-center">
                    <div class="mb-40 fade-in text-center">
                        <h1 class="font-cinzel text-[10rem] text-white tracking-tighter uppercase drop-shadow-[0_0_50px_rgba(185,28,28,0.6)]">The Triple A</h1>
                        <div class="flex items-center justify-center mt-8 space-x-16">
                            <div class="h-px bg-red-800 w-48 opacity-50"></div>
                            <p class="font-cinzel text-5xl text-red-700 tracking-[0.6em] font-bold">대괴도 AAA의 유산</p>
                            <div class="h-px bg-red-800 w-48 opacity-50"></div>
                        </div>
                    </div>
                    <div id="menu-list" class="flex flex-col w-[700px] space-y-4"></div>
                    <div class="absolute bottom-20 text-neutral-600 text-xl tracking-[1em] uppercase font-cinzel opacity-40">SELECT YOUR DESTINY</div>
                </div>
            `;

            const list = parent.querySelector('#menu-list');
            menuItems.forEach((item, idx) => {
                const btn = document.createElement('button');
                btn.className = `menu-btn font-cinzel text-4xl tracking-widest uppercase py-8 ${State.menuIndex === idx ? 'active' : 'text-neutral-500 hover:text-white'}`;
                btn.innerText = t(item.key);
                btn.onmouseenter = () => { State.menuIndex = idx; renderMenuButtons(); };
                btn.onclick = () => navigate(item.id);
                list.appendChild(btn);
            });
        }

        function renderMenuButtons() {
            const btns = document.querySelectorAll('.menu-btn');
            btns.forEach((btn, idx) => {
                if (idx === State.menuIndex) btn.classList.add('active');
                else btn.classList.remove('active');
            });
        }

        function renderGame(parent) {
            const view = State.currentView;
            parent.innerHTML = `
                <div id="bg-layer" class="absolute inset-0 bg-cover bg-center transition-all duration-1000 bg-transition" style="background-image: url('${view.background}')"></div>
                <div class="absolute inset-0 bg-black/40 z-10"></div>
                <div id="character-layer" class="absolute inset-0 z-20 flex justify-center items-end px-32 pointer-events-none pb-20"></div>
                <div class="absolute top-0 left-0 w-full z-40 p-16 flex justify-between items-center bg-gradient-to-b from-black/80 to-transparent">
                    <button id="btn-menu" class="px-12 py-4 bg-black/40 border border-white/10 rounded-full font-cinzel text-lg tracking-widest hover:bg-white/10 transition-all uppercase">Escape to Menu</button>
                    <div class="flex space-x-8">
                        <div class="text-neutral-500 font-cinzel border-l border-white/20 pl-8 h-8 flex items-center text-xl uppercase tracking-widest">Chapter 01: The Legacy</div>
                    </div>
                </div>
                <div class="absolute bottom-0 left-0 w-full z-30 p-20 cursor-pointer" id="game-click-area">
                    <div class="w-full max-w-[1600px] mx-auto rounded-[3rem] border border-white/10 p-16 textbox-gradient min-h-[350px]" style="background-color: rgba(0,0,0,${State.settings.opacity})">
                        <div id="name-box" class="text-red-700 mb-8 font-bold font-cinzel text-4xl tracking-[0.4em] border-l-8 border-red-900 pl-8 min-h-[1.5em]">
                            ${view.name ? t(view.name) : ''}
                        </div>
                        <div id="text-box" class="leading-relaxed text-neutral-100 italic font-serif" style="font-size: ${State.settings.fontSize}px; line-height: 1.6;"></div>
                    </div>
                </div>
                <div id="quiz-overlay" class="absolute inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm hidden">
                    <div class="w-[1200px] bg-neutral-950 border border-green-900/50 rounded-2xl overflow-hidden relative shadow-[0_0_100px_rgba(34,197,94,0.1)]">
                        <div class="bg-neutral-900 px-8 py-4 flex justify-between items-center border-b border-white/5">
                            <div class="flex space-x-2">
                                <div class="w-3 h-3 rounded-full bg-red-500/50"></div>
                                <div class="w-3 h-3 rounded-full bg-yellow-500/50"></div>
                                <div class="w-3 h-3 rounded-full bg-green-500/50"></div>
                            </div>
                            <div class="text-xs font-mono text-neutral-600 tracking-widest">TRIPLE-A SYSTEM OVERRIDE</div>
                        </div>
                        <div class="p-20 relative overflow-hidden">
                            <div class="absolute inset-0 crt-effect"></div>
                            <div class="scanline"></div>
                            <div class="relative z-10">
                                <div class="mb-12 terminal-text text-xl opacity-60 font-mono">> ACCESSING SECURE NODE...</div>
                                <div id="quiz-question" class="terminal-text text-4xl mb-16 leading-relaxed"></div>
                                <div class="flex border-2 border-green-900/30 p-4 bg-black/40">
                                    <span class="terminal-text text-4xl mr-6">></span>
                                    <input type="text" id="quiz-input" autocomplete="off" class="flex-1 bg-transparent terminal-text text-4xl outline-none placeholder:opacity-20 uppercase tracking-widest" placeholder="...">
                                </div>
                                <div class="mt-12 flex justify-between items-end">
                                    <div class="terminal-text text-lg opacity-40 italic" id="quiz-hint"></div>
                                    <button id="quiz-submit" class="border border-green-900/50 hover:bg-green-900/10 px-16 py-6 terminal-text text-2xl tracking-[0.5em] transition-all">EXECUTE</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            const charLayer = parent.querySelector('#character-layer');
            Object.entries(view.characters).forEach(([id, pos]) => {
                const img = document.createElement('img');
                // Character mapping
                const seed = id === 'AAA' ? 'TreasureHunter' : (id === '알루카드' ? 'ButlerA' : id);
                img.src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${seed}`;
                img.className = `h-[900px] object-contain drop-shadow-[0_50px_100px_rgba(0,0,0,0.95)] transition-all duration-1000 animate-fadeIn`;
                if (pos === 'left') img.style.marginRight = 'auto';
                else if (pos === 'right') img.style.marginLeft = 'auto';
                charLayer.appendChild(img);
            });

            const textBox = parent.querySelector('#text-box');
            parent.querySelector('#btn-menu').onclick = (e) => { e.stopPropagation(); navigate('MENU'); };

            if (view.dialogue) {
                let i = 0;
                State.isTextAnimating = true;
                textBox.innerText = '';
                const speed = 100 - (State.settings.textSpeed * 90);
                const timer = setInterval(() => {
                    textBox.innerText += view.dialogue[i++];
                    if (i >= view.dialogue.length) {
                        clearInterval(timer);
                        State.isTextAnimating = false;
                        textBox.classList.add('typewriter-cursor');
                        if (view.quiz) showQuizOverlay(parent, view.quiz);
                    }
                }, speed);

                parent.querySelector('#game-click-area').onclick = () => {
                    if (State.isTextAnimating) {
                        clearInterval(timer);
                        textBox.innerText = view.dialogue;
                        State.isTextAnimating = false;
                        textBox.classList.add('typewriter-cursor');
                        if (view.quiz) showQuizOverlay(parent, view.quiz);
                    } else if (!view.quiz) {
                        processNextEvent();
                    }
                };
            }
        }

        function showQuizOverlay(parent, event) {
            const overlay = parent.querySelector('#quiz-overlay');
            const qText = parent.querySelector('#quiz-question');
            const hText = parent.querySelector('#quiz-hint');
            const input = parent.querySelector('#quiz-input');
            const submitBtn = parent.querySelector('#quiz-submit');

            overlay.classList.remove('hidden');
            qText.innerText = event.options.question;
            hText.innerText = `HINT: ${event.options.hint}`;

            input.focus();
            const submit = () => {
                if (input.value.trim().toLowerCase() === event.value.toLowerCase()) {
                    overlay.classList.add('fade-out');
                    setTimeout(() => {
                        overlay.classList.add('hidden');
                        overlay.classList.remove('fade-out');
                        processNextEvent();
                    }, 1000);
                } else {
                    overlay.querySelector('.w-\\[1200px\\]').classList.add('animate-shake');
                    setTimeout(() => overlay.querySelector('.w-\\[1200px\\]').classList.remove('animate-shake'), 500);
                    input.value = '';
                }
            };

            submitBtn.onclick = (e) => { e.stopPropagation(); submit(); };
            input.onkeydown = (e) => { e.stopPropagation(); if (e.key === 'Enter') submit(); };
        }

        function handleGameEnd(value) {
            const nick = prompt("MISSION ACCOMPLISHED! Enter your code-name (3 chars):", "AAA") || "AAA";
            State.scores.unshift({ nickname: nick.substring(0, 3).toUpperCase(), date: new Date().toLocaleDateString(), playtime: Date.now() - State.startTime });
            localStorage.setItem('aaa_scores', JSON.stringify(State.scores));
            navigate('SCORE');
        }

        function renderOptions(parent) {
            parent.innerHTML = `
                <div class="h-full flex flex-col items-center justify-center space-y-20">
                    <div class="relative z-10 w-[1000px] space-y-16 bg-neutral-950/50 p-20 rounded-[4rem] border border-white/5">
                        <div class="text-center font-cinzel text-5xl tracking-[1em] text-white">CONFIG</div>
                        <div class="space-y-12">
                            <div class="flex justify-between items-center text-4xl font-serif px-10">
                                <span class="text-neutral-500">Language</span>
                                <div class="flex gap-4">
                                    ${['KO', 'EN', 'JP'].map(l => `<button class="px-8 py-3 border ${State.language === l ? 'border-red-600 bg-red-900/20 text-white' : 'border-white/10 text-neutral-600'} transition-all" onclick="window.setLang('${l}')">${l}</button>`).join('')}
                                </div>
                            </div>
                        </div>
                        <button class="w-full py-10 bg-neutral-900 hover:bg-red-900 text-3xl font-cinzel tracking-[0.5em] transition-all" onclick="window.navigateToMenu()">RETURN</button>
                    </div>
                </div>
             `;
            window.setLang = (l) => { State.language = l; render(); };
            window.navigateToMenu = () => navigate('MENU');
        }

        function renderScore(parent) {
            parent.innerHTML = `
                <div class="p-32 h-full flex flex-col">
                    <h2 class="text-9xl font-cinzel text-red-800 mb-20 tracking-tighter uppercase">Hall of Infamy</h2>
                    <div class="flex-1 overflow-y-auto pr-10 custom-scrollbar">
                        <table class="w-full text-left text-5xl font-cinzel">
                            <thead class="text-neutral-600 text-2xl uppercase tracking-[1em] border-b border-white/5">
                                <tr><th class="pb-10">CODE NAME</th><th class="pb-10">DATE</th></tr>
                            </thead>
                            <tbody>
                                ${State.scores.map(s => `<tr class="border-b border-white/5 hover:bg-white/5 transition-all"><td class="py-12 text-red-600">${s.nickname}</td><td class="text-neutral-400">${s.date}</td></tr>`).join('')}
                            </tbody>
                        </table>
                    </div>
                    <button class="mt-20 py-10 border border-white/10 hover:bg-white/5 text-4xl font-cinzel tracking-[1em] uppercase transition-all" onclick="window.navigateToMenu()">RETURN</button>
                </div>
            `;
            window.navigateToMenu = () => navigate('MENU');
        }

        function renderCredits(parent) { navigate('MENU'); }
        function renderExitConfirm(parent) { navigate('MENU'); }

        initGame();
    </script>
</body>

</html>